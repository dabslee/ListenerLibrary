{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ListenerLibrary Player</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="{% static 'css/style.css' %}" rel="stylesheet">
    <link href="{% static 'css/themes.css' %}" rel="stylesheet">
</head>
<body>
    <footer class="fixed-bottom bg-light border-top py-2">
        <div class="row align-items-center py-3 px-5">
            <div class="d-flex flex-md-row flex-column align-items-center justify-content-between gap-4">
                <div class="d-flex align-items-center col-md-4">
                    <img id="player-icon" src="" class="me-4" style="width: 60px; height: 60px; display: none; border-radius: 4px;">
                    <div>
                        <span id="player-track-name" class="fw-bold">No track selected</span>
                        <br>
                        <span id="player-track-artist" class="text-muted fst-italic">No artist</span>
                        <div id="player-playlist-info" class="text-muted small" style="display: none;">
                            <i class="fas fa-headphones me-1"></i> <span id="player-playlist-name" class="fw-bold"></span>
                        </div>
                    </div>
                </div>
                <div class="player-buttons-group d-flex align-items-center gap-1">
                    <button id="prev-track-btn" class="btn btn-secondary btn-sm" style="display: none;"><i class="fas fa-step-backward"></i></button>
                    <button id="skip-back-btn" class="btn btn-secondary btn-sm"><i class="fas fa-backward"></i></button>
                    <button id="play-pause-btn" class="btn btn-primary btn-sm"><i class="fas fa-play"></i></button>
                    <button id="skip-forward-btn" class="btn btn-secondary btn-sm"><i class="fas fa-forward"></i></button>
                    <button id="next-track-btn" class="btn btn-secondary btn-sm" style="display: none;"><i class="fas fa-step-forward"></i></button>
                    <button id="shuffle-btn" class="btn btn-secondary btn-sm" style="display: none;"><i class="fas fa-random"></i></button>
                    <select id="playback-speed" class="form-select form-select-sm" style="width: auto;">
                        <option value="0.5">0.5x</option>
                        <option value="0.75">0.75x</option>
                        <option value="0.9">0.9x</option>
                        <option value="1" selected>1x</option>
                        <option value="1.1">1.1x</option>
                        <option value="1.25">1.25x</option>
                        <option value="1.5">1.5x</option>
                        <option value="2">2x</option>
                    </select>
                </div>
                <div class="seek-bar-group d-flex align-items-center gap-1 flex-grow-1">
                    <span id="current-time" class="time-display">0:00</span>
                    <input type="range" id="seek-bar" class="form-range mx-2" value="0">
                    <span id="duration" class="time-display">0:00</span>
                    <button id="expand-player-btn" class="btn btn-outline-secondary btn-sm ms-2" title="Expand Player">
                        <i class="fas fa-expand-alt"></i>
                    </button>
                </div>
                <audio id="audio-player" class="d-none"></audio>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script id="playback-state-data" type="application/json">
    {% if playback_state and playback_state.track %}
    {
        "trackId": {{ playback_state.track.id }},
        "trackName": "{{ playback_state.track.name|escapejs }}",
        "trackArtist": "{% if playback_state.track.artist %}{{ playback_state.track.artist|escapejs }}{% else %}No artist{% endif %}",
        "trackIcon": "{% if playback_state.track.icon %}{{ playback_state.track.icon.url }}{% else %}{% endif %}",
        "trackStreamUrl": "{% url 'stream_track' playback_state.track.id %}",
        "position": {{ playback_state.last_played_position }},
        "duration": {{ playback_state.track.duration|default:0 }},
        "trackType": "{{ playback_state.track.type }}",
        "playlist": {% if playback_state.playlist %}{
            "id": {{ playback_state.playlist.id }},
            "name": "{{ playback_state.playlist.name|escapejs }}"
        }{% else %}null{% endif %},
        "shuffle": {% if playback_state.shuffle %}true{% else %}false{% endif %}
    }
    {% endif %}
    </script>
    <script src="{% static 'js/player.js' %}"></script>
</body>
</html>