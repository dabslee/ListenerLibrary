{% extends "raw_base.html" %}

{% block bodymods %}class="min-vh-100 d-flex flex-column"{% endblock %}

{% block content %}
<div class="d-flex flex-column flex-grow-1 justify-content-center align-items-center text-center w-100 p-4"
     style="max-width: 100%; margin: 0 auto;">
    <div class="w-100 mb-4" style="max-width: 400px;">
        <div class="rounded d-flex flex-column align-items-center justify-content-center w-100"
            style="aspect-ratio: 1 / 1; width: 100%; overflow: hidden; margin: 0 auto;">
            <img id="player-icon" src="" alt="Album artwork"
                class="img-fluid rounded w-100 d-none"
                style="
                    display: none;
                    aspect-ratio: 1 / 1;
                    object-fit: cover;
                    width: 100%;
                    height: 100%;
                    max-width: 400px;
                "
                onload="document.getElementById('player-art-placeholder').classList.add('d-none'); this.classList.remove('d-none'); this.style.display='block';"
                onerror="this.classList.add('d-none'); this.style.display='none'; document.getElementById('player-art-placeholder').classList.remove('d-none');">
            <div id="player-art-placeholder" class="text-muted small text-uppercase text-center"
                style="letter-spacing: 0.3em;">No Art</div>
        </div>
    </div>

    <div class="w-100" style="max-width: 600px;">
        <h2 id="player-track-name" class="fw-semibold mb-1">No track selected</h2>
        <p id="player-track-artist" class="text-muted fst-italic mb-4">No artist</p>

        <div class="w-100">
            <div class="d-flex justify-content-between text-muted small mb-1 gap-2">
                <span id="current-time">0:00</span>
                <input type="range" id="seek-bar" class="form-range" value="0">
                <span id="duration">0:00</span>
            </div>
        </div>

        <div class="d-flex flex-column gap-4 w-100 mt-4">
            <div class="d-flex flex-column">
                <div class="d-flex justify-content-center align-items-center gap-1">
                    <button id="prev-track-btn" class="btn btn-outline-secondary" type="button" title="Previous track">
                        <i class="fas fa-step-backward"></i>
                    </button>
                    <button id="skip-back-btn" class="btn btn-outline-secondary" type="button" title="Skip back 15s">
                        <i class="fas fa-backward"></i>
                    </button>
                    <button id="play-pause-btn" class="btn btn-primary rounded-circle d-flex align-items-center justify-content-center fs-4"
                            type="button" title="Play / Pause" style="width: 64px; height: 64px;">
                        <i class="fas fa-play"></i>
                    </button>
                    <button id="skip-forward-btn" class="btn btn-outline-secondary" type="button" title="Skip forward 15s">
                        <i class="fas fa-forward"></i>
                    </button>
                    <button id="next-track-btn" class="btn btn-outline-secondary" type="button" title="Next track">
                        <i class="fas fa-step-forward"></i>
                    </button>
                </div>
                <div class="align-items-center mt-2">
                    <button id="shuffle-btn" class="btn btn-outline-secondary" type="button" title="Shuffle">
                        <i class="fas fa-random"></i>
                    </button>
                    <select id="playback-speed"
                        class="btn btn-outline-secondary"
                        style="
                            width: auto;
                            height: calc(2.375rem); /* matches .btn height */
                            line-height: 1.5;
                            padding: 0 0.75rem;
                            text-align: center;
                            appearance: none;
                        ">
                        <option value="0.5">0.5x</option>
                        <option value="0.75">0.75x</option>
                        <option value="0.9">0.9x</option>
                        <option value="1" selected>1x</option>
                        <option value="1.1">1.1x</option>
                        <option value="1.25">1.25x</option>
                        <option value="1.5">1.5x</option>
                        <option value="2">2x</option>
                    </select>
                </div>
            </div>
        </div>

        <audio id="audio-player" class="d-none"></audio>
    </div>
</div>
{% endblock %}

{% block player_footer %}{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function () {
    const artImg = document.getElementById('player-icon');
    const placeholder = document.getElementById('player-art-placeholder');
    const mainEl = document.querySelector('main.container');
    const navbar = document.querySelector('nav.navbar');

    function syncPlaceholder() {
        if (!artImg || !placeholder) {
            return;
        }
        const shouldShowPlaceholder = !artImg.src || artImg.style.display === 'none';
        placeholder.classList.toggle('d-none', !shouldShowPlaceholder);
    }

    if (artImg) {
        artImg.addEventListener('load', function () {
            artImg.style.display = 'block';
            syncPlaceholder();
        });

        artImg.addEventListener('error', function () {
            artImg.style.display = 'none';
            syncPlaceholder();
        });

        const observer = new MutationObserver(syncPlaceholder);
        observer.observe(artImg, { attributes: true, attributeFilter: ['style', 'src'] });
    }

    syncPlaceholder();

    if (mainEl) {
        mainEl.classList.remove('mt-4', 'mb-5', 'pb-5');
        mainEl.classList.add('d-flex', 'flex-column', 'flex-grow-1', 'justify-content-center');
        mainEl.style.paddingBottom = '0';
        mainEl.style.marginBottom = '0';
        mainEl.style.marginTop = '0';
        const navHeight = navbar ? navbar.offsetHeight : 0;
        mainEl.style.minHeight = `calc(100vh - ${navHeight}px)`;
        mainEl.style.width = '100%';
    }
});
</script>
{% endblock %}
